<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Gilded Rose</title>
	<link href="css/bootstrap.min.css" rel="stylesheet">
</head>

<body style="padding-top: 60px;">

<div class="navbar navbar-fixed-top">
	<div class="navbar-inner">
		<div class="container">
			<a class="brand" href="#">Gilded Rose Inn</a>
		</div>
	</div>
</div>

<div class="container">
	<h1>Inventory</h1>

	<div id="inventory"></div>

	<a class="btn btn-primary" id="update" href="#">Update Quality</a>
</div>

<script src="js/jquery-1.7.1.min.js"></script>
<script src="js/mustache.js"></script>
<script id="inventoryTemplate" type="text/template">
	<table class="table table-striped">
		<thead>
		<tr>
			<th>Item</th>
			<th>Sell in</th>
			<th>Quality</th>
		</tr>
		</thead>
		<tbody>
		{{#.}}
		<tr>
			<td>{{name}}</td>
			<td>{{sellIn}} days</td>
			<td>{{quality}}</td>
		</tr>
		{{/.}}
		</tbody>
	</table>
</script>
<script>
var herokuUrl = 'http://localhost:8080';

function updateItems() {
    $.getJSON(herokuUrl + '?callback=?', function (json) {
        $('#inventory').html(Mustache.to_html($('#inventoryTemplate').html(), json));
    });
}

$('#update').click(function() {
	$.ajax({
		url: herokuUrl + '/update',
		dataType: "script"
	}).done(updateItems);
});

updateItems();

</script>

</body>
</html>